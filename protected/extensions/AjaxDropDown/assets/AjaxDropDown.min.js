!function(a){a.fn.ajaxDropDown=function(e){var s=a.extend(!0,{activeClass:"active",disabledClass:"disabled",errorClass:"",errorStyle:"",headerClass:"",headerStyle:"",hiddenClass:"hidden",loadingClass:"",loadingStyle:"",markBegin:"",markEnd:"",minQuery:0,name:"ajaxDropDown",nextBegin:"",nextClass:"",nextEnd:"",nextStyle:"",noRecordsClass:"",noRecordsStyle:"",pagerBegin:"",pagerEnd:"",previousBegin:"",previousClass:"",previousEnd:"",previousStyle:"",progressBar:"",recordClass:"",recordStyle:"",removeClass:"",removeLabel:"",removeStyle:"",resultClass:"",resultStyle:"",singleMode:!1,switchClass:"",switchStyle:"",triggerEvent:"",url:"",local:{allRecords:"All records",recordsContaining:"Records containing",minimumCharacters:"Type at least {NUM} character(s) to filter the results...",error:"Error",previous:"previous",next:"next",noRecords:"No matching records found"}},e),r=this.find(".ajaxDropDownMenu"),n='<li class="ajaxDropDownLoading';""!==s.loadingClass&&(n+=" "+s.loadingClass),n+='"',""!==s.loadingStyle&&(n+=' style="'+s.loadingStyle+'"'),n+=">"+s.progressBar+"</li>";var o='<li class="dropdown-header';""!==s.headerClass&&(o+=" "+s.headerClass),o+='"',""!==s.headerStyle&&(o+=' style="'+s.headerStyle+'"'),o+=">";var l=s.local.minimumCharacters.replace(/{NUM}/g,s.minQuery),t='<li class="dropdown-header';""!==s.errorClass&&(t+=" "+s.errorClass),t+='"',""!==s.errorStyle&&(t+=' style="'+s.errorStyle+'"'),t+=">"+s.local.error+"</li>";var d='<li class="dropdown-header';return""!==s.noRecordsClass&&(d+=" "+s.noRecordsClass),d+='"',""!==s.noRecordsStyle&&(d+=' style="'+s.noRecordsStyle+'"'),d+=">"+s.local.noRecords+"</li>",this.on(s.triggerEvent,function(){if(0===r.find(".ajaxDropDownPages").length){var e=a(this).find(".ajaxDropDownToggle").data("page");e=1*e;var p=!1,D=o+s.pagerBegin+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>';D+=s.pagerEnd+s.local.allRecords+'</li><li class="divider"></li>'+n;var c=a(this).find("input[type=text]").val();s.minQuery>0?c.length>=s.minQuery?(D=o+s.pagerBegin+'<span class="ajaxDropDownPageNumber">'+e+'</span>/<span class="ajaxDropDownTotalPages">1</span>',D+=s.pagerEnd+s.local.recordsContaining+" <strong>"+c,D+='</strong>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</li><li class="divider"></li>'+n,p=!0):D=o+l+"</li>":p=!0,r.html(D),p&&a.post(s.url,{query:c,page:e}).fail(function(){r.append(t)}).done(function(e){var n=a.parseJSON(e);if(void 0===n.total&&(n.total=1),void 0===n.page&&(n.page=1),n.data.length){r.find(".ajaxDropDownTotalPages").text(n.total);for(i in n.data){var o='<li class="ajaxDropDownPages ajaxDropDownPage'+n.page+" ajaxDropDownRecord"+n.data[i].id;""!==s.recordClass&&(o+=" "+s.recordClass),r.parent().parent().parent().find(".ajaxDropDownSelected"+n.data[i].id).length&&(o+=" "+s.activeClass),o+='"',""!==s.recordStyle&&(o+=' style="'+s.recordStyle+'"'),o+='><a href="#" class="ajaxDropDownResult" data-id="'+n.data[i].id+'">',n.data[i].mark&&(o+=s.markBegin),o+=n.data[i].value,n.data[i].mark&&(o+=s.markEnd),o+="</a></li>",r.append(o)}if(n.total>1){var l='<li class="divider ajaxDropDownInfo"></li><li class="ajaxDropDownInfo';""!==s.switchClass&&(l+=" "+s.switchClass),l+='"',""!==s.switchStyle&&(l+=' style="'+s.switchStyle+'"'),l+='><a href="#" class="ajaxDropDownPrev',""!==s.previousClass&&(l+=" "+s.previousClass),1===n.page&&(l+=" "+s.disabledClass),l+='"',""!==s.previousStyle&&(l+=' style="'+s.previousStyle+'"'),l+=">"+s.previousBegin+s.local.previous+s.previousEnd+'</a><a href="#" class="ajaxDropDownNext',""!==s.nextClass&&(l+=" "+s.nextClass),n.page===n.total&&(l+=" "+s.disabledClass),l+='"',""!==s.nextStyle&&(l+=' style="'+s.nextStyle+'"'),l+=">"+s.nextBegin+s.local.next+s.nextEnd+"</a></li>",r.append(l)}}else r.append(d)}).always(function(){a(".ajaxDropDownLoading").remove()})}}),this.on("click",".ajaxDropDownNext",function(e){e.preventDefault(),e.stopPropagation(),r.find(".ajaxDropDownPrev").removeClass(s.disabledClass),r.find(".ajaxDropDownNext").addClass(s.disabledClass);var n=r.parent().find(".ajaxDropDownToggle").data("page");if(n=1*n+1,r.find(".ajaxDropDownPage"+n).length)r.find(".ajaxDropDownPages").addClass(s.hiddenClass),r.find(".ajaxDropDownPage"+n).removeClass(s.hiddenClass),r.find(".ajaxDropDownNext").removeClass(s.disabledClass);else{var o=r.parent().parent().find("input[type=text]").val();a.post(s.url,{query:o,page:n}).fail(function(){r.append(t)}).done(function(e){var o=a.parseJSON(e);if(o.data.length){r.find(".ajaxDropDownPages").addClass(s.hiddenClass),void 0===o.total&&(o.total=1),void 0===o.page&&(o.page=1);for(i in o.data){var l='<li class="ajaxDropDownPages ajaxDropDownPage'+o.page+" ajaxDropDownRecord"+o.data[i].id;""!==s.recordClass&&(l+=" "+s.recordClass),r.parent().parent().parent().find(".ajaxDropDownSelected"+o.data[i].id).length&&(l+=" "+s.activeClass),l+='"',""!==s.recordStyle&&(l+=' style="'+s.recordStyle+'"'),l+='><a href="#" class="ajaxDropDownResult" data-id="'+o.data[i].id+'">',o.data[i].mark&&(l+=s.markBegin),l+=o.data[i].value,o.data[i].mark&&(l+=s.markEnd),l+="</a></li>",r.find(".divider.ajaxDropDownInfo").before(l)}o.page<o.total?r.find(".ajaxDropDownNext").removeClass(s.disabledClass):n=o.total}else r.append(d)})}r.parent().find(".ajaxDropDownToggle").data("page",n),r.find(".ajaxDropDownPageNumber").text(n)}),this.on("click",".ajaxDropDownPrev",function(a){a.preventDefault(),a.stopPropagation(),r.find(".ajaxDropDownNext").removeClass(s.disabledClass),r.find(".ajaxDropDownPrev").addClass(s.disabledClass);var e=r.parent().find(".ajaxDropDownToggle").data("page");e=1*e-1,1>e&&(e=1),r.find(".ajaxDropDownPages").addClass(s.hiddenClass),r.find(".ajaxDropDownPage"+e).removeClass(s.hiddenClass),e>1&&r.find(".ajaxDropDownPrev").removeClass(s.disabledClass),r.parent().find(".ajaxDropDownToggle").data("page",e),r.find(".ajaxDropDownPageNumber").text(e)}),this.on("keyup","input[type=text]",function(){a(this).parent().find(".ajaxDropDownToggle").data("page",1),a(this).parent().find(".ajaxDropDownMenu").find(".ajaxDropDownPages").remove()}),this.on("click",".ajaxDropDownResult",function(e){e.preventDefault();var r=a(this).data("id"),n=a(this).html(),o=a(this).parent().parent().parent().parent().parent().find(".ajaxDropDownResults"),l="[]";if(s.singleMode&&(o.html(""),a(this).parent().parent().find(".ajaxDropDownPages").removeClass(s.activeClass),l=""),a(this).parent().hasClass(s.activeClass))a(this).parent().removeClass(s.activeClass),o.find(".ajaxDropDownSelected"+r).remove();else{a(this).parent().addClass(s.activeClass),s.singleMode&&(l="");var t='<li class="ajaxDropDownSelected'+r;""!==s.resultClass&&(t+=" "+s.resultClass),t+='"',""!==s.resultStyle&&(t+=' style="'+s.resultStyle+'"'),t+='><a href="#" class="ajaxDropDownRemove',""!==s.removeClass&&(t+=" "+s.removeClass),t+='"',""!==s.removeStyle&&(t+=' style="'+s.removeStyle+'"'),t+=' data-id="'+r+'">'+s.removeLabel+"</a>"+n+'<input type="hidden" name="'+s.name+l+'" value="'+r+'" /></li>',o.append(t)}}),this.on("click",".ajaxDropDownRemove",function(e){e.preventDefault(),a(this).parent().parent().parent().find(".ajaxDropDownRecord"+a(this).data("id")).removeClass(s.activeClass),a(this).parent().remove()}),this}}(jQuery);
